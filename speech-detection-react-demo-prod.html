<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo React - Detecci√≥n de Habla (Producci√≥n)</title>
    
    <!-- React y ReactDOM desde CDN - Versiones de producci√≥n -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para transformar JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Pitchy dependency -->
    <script src="https://unpkg.com/pitchy@4.1.0/dist/pitchy.umd.js"></script>
    
    <!-- Nuestra librer√≠a compilada en formato UMD -->
    <script src="./dist/index.umd.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .production-badge {
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            border: 2px solid #28a745;
        }
        .content {
            padding: 30px;
        }
        .config-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid #dee2e6;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .control-group {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .slider {
            width: 100%;
            margin: 10px 0;
        }
        .buttons {
            text-align: center;
            margin: 30px 0;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%);
        }
        .status {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            text-align: center;
            font-size: 18px;
        }
        .status.listening {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        .status.not-listening {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
            color: white;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .silence-countdown {
            background: white;
            border: 2px solid #dc3545;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .countdown-bar {
            height: 25px;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .countdown-progress {
            height: 100%;
            border-radius: 12px;
            transition: width 0.05s linear, background-color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.7);
            position: relative;
        }
        .countdown-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255,255,255,0.2) 0%, 
                rgba(255,255,255,0) 50%, 
                rgba(255,255,255,0.2) 100%);
            border-radius: 12px;
        }
        .countdown-pulse {
            animation: countdownPulse 1s ease-in-out infinite;
        }
        @keyframes countdownPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(220, 53, 69, 0.3); }
            50% { box-shadow: 0 0 20px rgba(220, 53, 69, 0.6); }
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .events-container {
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        .events-header {
            background: #343a40;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .events-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
        }
        .event {
            background: white;
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .event.start {
            border-left-color: #28a745;
            background: linear-gradient(90deg, #d4edda 0%, white 20%);
        }
        .event.end {
            border-left-color: #ffc107;
            background: linear-gradient(90deg, #fff3cd 0%, white 20%);
        }
        .event.silence {
            border-left-color: #dc3545;
            background: linear-gradient(90deg, #f8d7da 0%, white 20%);
        }
        .transcript {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            min-height: 100px;
        }
        .interim {
            color: #6c757d;
            font-style: italic;
            animation: typing 1s infinite;
        }
        @keyframes typing {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .instructions {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
        }
        .instructions h3 {
            margin-top: 0;
        }
        .instructions ul {
            list-style: none;
            padding: 0;
        }
        .instructions li {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }
        .instructions li::before {
            content: "‚ñ∂";
            position: absolute;
            left: 0;
            color: #ffc107;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }
        .audio-visualizer {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin: 5px 0;
        }
        .audio-level {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            transition: width 0.1s ease;
            border-radius: 2px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }
        .performance-note {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            color: #0066cc;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">üîÑ Cargando componentes React...</div>
    </div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        // Importar el hook desde nuestra librer√≠a
        const { useSpeechToText } = window.ReactSpeechToTextGK || {};
        
        const SpeechDetectionApp = () => {
            const [speechVolumeThreshold, setSpeechVolumeThreshold] = useState(15);
            const [speechPauseThreshold, setSpeechPauseThreshold] = useState(200);
            const [isRealTimeLogging, setIsRealTimeLogging] = useState(false); // Desactivado por defecto en producci√≥n
            
            // Estado para eventos de habla con m√°s detalles
            const [speechEvents, setSpeechEvents] = useState([]);
            
            // Estado para la barra de countdown de silencio
            const [silenceCountdown, setSilenceCountdown] = useState({
                isActive: false,
                percentage: 100,
                timeLeft: 0
            });
            
            // Estado para m√©tricas de sesi√≥n
            const [speechSession, setSpeechSession] = useState({
                isCurrentlySpeaking: false,
                currentSessionStart: null,
                totalSpeechTime: 0,
                totalSilenceTime: 0,
                speechSegments: 0
            });

            const lastSpeechEndRef = useRef(0);
            const eventIdRef = useRef(0);
            const silenceCountdownIntervalRef = useRef(null);
            const lastSpeechActivityRef = useRef(0);

            // Verificar si el hook est√° disponible
            if (!useSpeechToText) {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>‚ùå Error de Carga</h1>
                            <div className="error">
                                <strong>No se pudo cargar la librer√≠a react-speech-to-text-gk.</strong>
                                <br />
                                Aseg√∫rate de que el archivo dist/index.umd.js est√© disponible.
                            </div>
                        </div>
                    </div>
                );
            }

            const {
                isListening,
                transcript,
                interimTranscript,
                isSupported,
                audioMetrics,
                startListening,
                stopListening,
                clearTranscript
            } = useSpeechToText({
                language: 'es-ES',
                speechVolumeThreshold,
                speechPauseThreshold,
                silenceTimeout: 3000,
                onSpeechStart: (data) => {
                    const currentTime = Date.now();
                    const eventId = ++eventIdRef.current;
                    
                    lastSpeechActivityRef.current = currentTime;
                    stopSilenceCountdown();
                    
                    const silenceDuration = lastSpeechEndRef.current > 0 
                        ? currentTime - lastSpeechEndRef.current 
                        : 0;
                    
                    setSpeechSession(prev => ({
                        ...prev,
                        isCurrentlySpeaking: true,
                        currentSessionStart: currentTime,
                        totalSilenceTime: prev.totalSilenceTime + silenceDuration,
                        speechSegments: prev.speechSegments + 1
                    }));

                    setSpeechEvents(prev => [...prev.slice(-19), {
                        id: eventId,
                        type: 'start',
                        timestamp: currentTime,
                        data: {
                            ...data,
                            silenceBeforeSpeech: silenceDuration
                        }
                    }]);

                    if (isRealTimeLogging) {
                        console.log('üé§ INICIO DE HABLA:', {
                            volumen: data.triggerVolume.toFixed(1),
                            pitch: data.startPitch.toFixed(1),
                            silencioAnterior: silenceDuration + 'ms'
                        });
                    }
                },
                onSpeechEnd: (data) => {
                    const currentTime = Date.now();
                    const eventId = ++eventIdRef.current;
                    lastSpeechEndRef.current = currentTime;
                    
                    lastSpeechActivityRef.current = currentTime;
                    startSilenceCountdown();
                    
                    const speechDuration = speechSession.currentSessionStart 
                        ? currentTime - speechSession.currentSessionStart 
                        : 0;

                    setSpeechSession(prev => ({
                        ...prev,
                        isCurrentlySpeaking: false,
                        currentSessionStart: null,
                        totalSpeechTime: prev.totalSpeechTime + speechDuration
                    }));

                    setSpeechEvents(prev => [...prev.slice(-19), {
                        id: eventId,
                        type: 'end',
                        timestamp: currentTime,
                        data: {
                            ...data,
                            speechDuration
                        },
                        duration: speechDuration
                    }]);

                    if (isRealTimeLogging) {
                        console.log('ü§ê FIN DE HABLA:', {
                            duracionHabla: speechDuration + 'ms',
                            pausa: data.pauseDuration + 'ms',
                            volumenFinal: data.endVolume.toFixed(1)
                        });
                    }
                },
                onSilenceDetected: (data) => {
                    const eventId = ++eventIdRef.current;
                    
                    stopSilenceCountdown();
                    
                    setSpeechEvents(prev => [...prev.slice(-19), {
                        id: eventId,
                        type: 'silence',
                        timestamp: Date.now(),
                        data
                    }]);

                    if (isRealTimeLogging) {
                        console.log('üîá SILENCIO DETECTADO:', {
                            tiempoSinHabla: data.timeSinceLastSpeech + 'ms',
                            timeout: data.silenceTimeout + 'ms'
                        });
                    }
                }
            });

            // Funciones para manejar el countdown de silencio
            const startSilenceCountdown = () => {
                stopSilenceCountdown();
                
                const silenceTimeout = 3000;
                const updateInterval = 50;
                
                setSilenceCountdown({
                    isActive: true,
                    percentage: 100,
                    timeLeft: silenceTimeout
                });
                
                silenceCountdownIntervalRef.current = setInterval(() => {
                    const currentTime = Date.now();
                    const elapsed = currentTime - lastSpeechActivityRef.current;
                    const remaining = Math.max(0, silenceTimeout - elapsed);
                    const percentage = (remaining / silenceTimeout) * 100;
                    
                    setSilenceCountdown({
                        isActive: remaining > 0,
                        percentage: Math.round(percentage),
                        timeLeft: remaining
                    });
                    
                    if (remaining <= 0) {
                        stopSilenceCountdown();
                    }
                }, updateInterval);
            };
            
            const stopSilenceCountdown = () => {
                if (silenceCountdownIntervalRef.current) {
                    clearInterval(silenceCountdownIntervalRef.current);
                    silenceCountdownIntervalRef.current = null;
                }
                
                setSilenceCountdown({
                    isActive: false,
                    percentage: 100,
                    timeLeft: 0
                });
            };

            // Limpiar eventos cuando se para la escucha
            useEffect(() => {
                if (!isListening) {
                    setSpeechSession({
                        isCurrentlySpeaking: false,
                        totalSpeechTime: 0,
                        totalSilenceTime: 0,
                        speechSegments: 0
                    });
                    lastSpeechEndRef.current = 0;
                    stopSilenceCountdown();
                }
                
                return () => {
                    stopSilenceCountdown();
                };
            }, [isListening]);

            const formatDuration = (ms) => {
                return ms < 1000 ? `${ms}ms` : `${(ms / 1000).toFixed(1)}s`;
            };

            const formatTime = (timestamp) => {
                return new Date(timestamp).toLocaleTimeString('es-ES', {
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    fractionalSecondDigits: 3
                });
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>üéØ Demo React - Detecci√≥n de Habla</h1>
                        <p>Versi√≥n optimizada para producci√≥n</p>
                        <div className="production-badge">
                            ‚úÖ VERSI√ìN PRODUCCI√ìN: Sin advertencias de desarrollo
                        </div>
                    </div>

                    <div className="content">
                        <div className="performance-note">
                            <strong>üöÄ Optimizado para producci√≥n:</strong> Esta versi√≥n usa React production build y est√° optimizada para el mejor rendimiento. Sin advertencias de desarrollo.
                        </div>

                        {!isSupported && (
                            <div className="error">
                                <strong>‚ö†Ô∏è Tu navegador no soporta Speech Recognition</strong>
                                <br />
                                Prueba con Chrome, Edge o Safari para la mejor experiencia.
                            </div>
                        )}

                        <div className="config-section">
                            <h3>‚öôÔ∏è Configuraci√≥n de Detecci√≥n</h3>
                            <div className="controls">
                                <div className="control-group">
                                    <h4>üîä Umbral de Volumen ({speechVolumeThreshold}%)</h4>
                                    <input
                                        type="range"
                                        className="slider"
                                        min="5"
                                        max="50"
                                        value={speechVolumeThreshold}
                                        onChange={(e) => setSpeechVolumeThreshold(Number(e.target.value))}
                                        disabled={isListening}
                                    />
                                    <small>Volumen m√≠nimo para detectar habla</small>
                                    <div className="audio-visualizer">
                                        <div 
                                            className="audio-level" 
                                            style={{width: `${audioMetrics.currentVolume}%`}}
                                        ></div>
                                    </div>
                                </div>
                                
                                <div className="control-group">
                                    <h4>‚è±Ô∏è Pausa para Fin ({speechPauseThreshold}ms)</h4>
                                    <input
                                        type="range"
                                        className="slider"
                                        min="100"
                                        max="1000"
                                        step="50"
                                        value={speechPauseThreshold}
                                        onChange={(e) => setSpeechPauseThreshold(Number(e.target.value))}
                                        disabled={isListening}
                                    />
                                    <small>Duraci√≥n de pausa para detectar fin</small>
                                </div>
                            </div>

                            <div style={{marginTop: '15px'}}>
                                <label>
                                    <input
                                        type="checkbox"
                                        checked={isRealTimeLogging}
                                        onChange={(e) => setIsRealTimeLogging(e.target.checked)}
                                        style={{marginRight: '8px'}}
                                    />
                                    Logging detallado en consola (opcional)
                                </label>
                            </div>
                        </div>

                        <div className={`status ${isListening ? 'listening' : 'not-listening'}`}>
                            {isListening ? (
                                <>
                                    üé§ ESCUCHANDO - {speechSession.isCurrentlySpeaking ? 'HABLANDO' : 'EN SILENCIO'}
                                    <br />
                                    <small>
                                        Volumen: {audioMetrics.currentVolume.toFixed(1)}% | 
                                        Pitch: {audioMetrics.currentPitch.toFixed(1)}Hz
                                    </small>
                                </>
                            ) : (
                                '‚è∏Ô∏è DETENIDO - Presiona "Iniciar" para comenzar la detecci√≥n'
                            )}
                        </div>

                        {/* Barra de countdown de silencio - SIEMPRE VISIBLE */}
                        {isListening && (
                            <div className={`silence-countdown ${silenceCountdown.isActive && silenceCountdown.percentage < 20 ? 'countdown-pulse' : ''}`}>
                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px'}}>
                                    <h3 style={{
                                        margin: 0, 
                                        color: silenceCountdown.isActive ? '#dc3545' : '#28a745'
                                    }}>
                                        {silenceCountdown.isActive ? 
                                            '‚è±Ô∏è Countdown hacia Detecci√≥n de Silencio' : 
                                            speechSession.isCurrentlySpeaking ? 
                                                'üé§ Hablando - Countdown pausado' : 
                                                'üîÑ Esperando actividad de voz'
                                        }
                                    </h3>
                                    <span style={{color: '#666', fontWeight: 'bold', fontSize: '16px'}}>
                                        {silenceCountdown.isActive ? 
                                            `${(silenceCountdown.timeLeft / 1000).toFixed(1)}s restantes` : 
                                            speechSession.isCurrentlySpeaking ? 
                                                'HABLANDO' : 
                                                'LISTO'
                                        }
                                    </span>
                                </div>
                                <div className="countdown-bar">
                                    <div 
                                        className="countdown-progress"
                                        style={{
                                            width: `${silenceCountdown.percentage}%`,
                                            backgroundColor: !silenceCountdown.isActive ? 
                                                (speechSession.isCurrentlySpeaking ? '#17a2b8' : '#6c757d') :
                                                silenceCountdown.percentage > 66 ? '#28a745' : 
                                                silenceCountdown.percentage > 33 ? '#ffc107' : '#dc3545'
                                        }}
                                    >
                                        {!silenceCountdown.isActive ? 
                                            (speechSession.isCurrentlySpeaking ? 'HABLANDO' : 'ESPERANDO') :
                                            `${silenceCountdown.percentage}%`
                                        }
                                    </div>
                                </div>
                                <div style={{textAlign: 'center', marginTop: '10px', fontSize: '13px', color: '#666'}}>
                                    {silenceCountdown.isActive ? 
                                        'Countdown activo - La barra baja hasta llegar a 0%' :
                                        speechSession.isCurrentlySpeaking ?
                                            'Hablando - El countdown se pausar√° hasta que dejes de hablar' :
                                            'Cuando dejes de hablar, iniciar√° el countdown de 3 segundos'
                                    }
                                </div>
                            </div>
                        )}

                        {isListening && (
                            <div className="metrics">
                                <div className="metric-card">
                                    <h4 style={{margin: '0 0 10px 0', color: '#28a745'}}>üìä M√©tricas de Sesi√≥n</h4>
                                    <div><strong>Segmentos de habla:</strong> {speechSession.speechSegments}</div>
                                    <div><strong>Tiempo hablando:</strong> {formatDuration(speechSession.totalSpeechTime)}</div>
                                    <div><strong>Tiempo en silencio:</strong> {formatDuration(speechSession.totalSilenceTime)}</div>
                                </div>
                                
                                <div className="metric-card">
                                    <h4 style={{margin: '0 0 10px 0', color: '#dc3545'}}>üîä Audio en Tiempo Real</h4>
                                    <div><strong>Volumen:</strong> {audioMetrics.currentVolume.toFixed(1)}%</div>
                                    <div><strong>Pitch:</strong> {audioMetrics.currentPitch.toFixed(1)}Hz</div>
                                    <div><strong>Centroide:</strong> {audioMetrics.currentSpectralCentroid.toFixed(1)}Hz</div>
                                </div>
                            </div>
                        )}

                        <div className="buttons">
                            <button
                                className="btn"
                                onClick={startListening}
                                disabled={!isSupported || isListening}
                            >
                                üé§ Iniciar Detecci√≥n
                            </button>
                            
                            <button
                                className="btn btn-danger"
                                onClick={stopListening}
                                disabled={!isSupported || !isListening}
                            >
                                ‚èπÔ∏è Detener
                            </button>
                            
                            <button
                                className="btn btn-secondary"
                                onClick={clearTranscript}
                                disabled={!isSupported}
                            >
                                üóëÔ∏è Limpiar
                            </button>
                        </div>

                        <div className="events-container">
                            <div className="events-header">
                                <h3 style={{margin: 0}}>üìÖ Eventos de Habla (√öltimos 20)</h3>
                                <button
                                    className="btn btn-secondary"
                                    onClick={() => setSpeechEvents([])}
                                    style={{padding: '5px 15px', fontSize: '12px', margin: 0}}
                                >
                                    Limpiar
                                </button>
                            </div>
                            
                            <div className="events-list">
                                {speechEvents.length === 0 ? (
                                    <div style={{padding: '20px', textAlign: 'center', color: '#666'}}>
                                        No hay eventos a√∫n. Inicia la escucha y comienza a hablar.
                                    </div>
                                ) : (
                                    speechEvents.slice().reverse().map((event) => {
                                        let className = 'event';
                                        let icon = '';
                                        let description = '';
                                        
                                        switch (event.type) {
                                            case 'start':
                                                className += ' start';
                                                icon = 'üé§';
                                                description = `INICIO - Vol: ${event.data.triggerVolume?.toFixed(1)}%, Pitch: ${event.data.startPitch?.toFixed(1)}Hz`;
                                                if (event.data.silenceBeforeSpeech > 0) {
                                                    description += `, Silencio anterior: ${formatDuration(event.data.silenceBeforeSpeech)}`;
                                                }
                                                break;
                                            case 'end':
                                                className += ' end';
                                                icon = 'ü§ê';
                                                description = `FIN - Duraci√≥n: ${formatDuration(event.duration || 0)}, Pausa: ${event.data.pauseDuration}ms`;
                                                break;
                                            case 'silence':
                                                className += ' silence';
                                                icon = 'üîá';
                                                description = `SILENCIO - ${formatDuration(event.data.timeSinceLastSpeech)} sin habla`;
                                                break;
                                        }
                                        
                                        return (
                                            <div key={event.id} className={className}>
                                                <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center'}}>
                                                    <div>
                                                        <span style={{marginRight: '8px'}}>{icon}</span>
                                                        <strong>{formatTime(event.timestamp)}</strong>
                                                        <span style={{marginLeft: '10px'}}>{description}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })
                                )}
                            </div>
                        </div>

                        <div className="transcript">
                            <h3>üìù Transcripci√≥n</h3>
                            <div>
                                <strong>Texto final:</strong>
                                <div style={{marginTop: '10px', lineHeight: '1.5'}}>
                                    {transcript || <span style={{color: '#999'}}>Nada transcrito a√∫n...</span>}
                                </div>
                            </div>
                            {interimTranscript && (
                                <div style={{marginTop: '15px'}}>
                                    <strong>Texto en progreso:</strong>
                                    <div className="interim" style={{marginTop: '5px'}}>
                                        {interimTranscript}
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="instructions">
                            <h3>üöÄ Demo React en Producci√≥n</h3>
                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '30px'}}>
                                <div>
                                    <h4>‚úÖ Optimizaciones aplicadas:</h4>
                                    <ul>
                                        <li>React production build</li>
                                        <li>Sin advertencias de desarrollo</li>
                                        <li>Logging desactivado por defecto</li>
                                        <li>Rendimiento optimizado</li>
                                        <li>Tama√±o reducido</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4>üîç Funcionalidades:</h4>
                                    <ul>
                                        <li>üé§ Detecci√≥n inicio inmediato</li>
                                        <li>ü§ê Detecci√≥n fin inmediato</li>
                                        <li>‚è±Ô∏è Countdown visual de 3s</li>
                                        <li>üìä M√©tricas en tiempo real</li>
                                        <li>üéõÔ∏è Controles configurables</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Renderizar usando React 18 createRoot API (sin advertencias)
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpeechDetectionApp />);
    </script>
</body>
</html>